---
title: "Introduction to package *ggplot2* part 2"
author: "Mariusz Rafało"
output:
  html_document: default
  html_notebook: default
editor_options: 
  chunk_output_type: console
---

*Support material for class: Data Visualisation and Presentation at Warsaw School of Economics*

&copy; *Copyright Mariusz Rafało*

---

####Summary
This document presents basic concepts of decision tree analysis performed in *R*.

####Data
Dataset *edw_cdr.csv* was downloaded from [Showcase for using H2O and R for churn prediction](https://github.com/ZhouFang928/sql-server-samples/tree/master/samples/features/r-services/Telco%20Customer%20Churn%20v1) repository.

####Introduction 

Environment setup

```{r setup, include=FALSE, ECHO=FALSE}
knitr::opts_chunk$set(fig.width=5, fig.height=5, echo=TRUE, warning=FALSE, message=FALSE)
```

Load data from *edw_cdr.csv* file

```{r}

#dane1m <- as.data.frame(fread("E:/Data Sets/telco churn (edw)/edw_cdr.csv"))
dane1m <- read.csv(file="E:/Data Sets/telco churn (edw)/edw_cdr.csv", header=TRUE, sep=",")

dane <- dane1m
```

Libraries used
```{r}
library(ggplot2)
library(data.table) #fread
library(reshape2) #melt
library(cluster)

```


####Example 1

```{r}

ggplot(data = dane1m, aes(x=percentagecalloutsidenetwork, y=totalminsusedinlastmonth)) +
 geom_point(aes(color = as.factor(churn)), alpha = 0.4) +
   scale_color_manual(values=c("green", "red"), name="Churn",
                       breaks=c("0", "1"),
                       labels=c("No", "Yes"))
```


####Example 2
```{r}
ggplot(data = dane1m, aes(x=percentagecalloutsidenetwork, y=totalminsusedinlastmonth)) +
  geom_point(aes(color = churn)) +
     scale_color_gradient(low = "green", high = "red")
```

####Example 3 (heatmap)

```{r}
ggplot(data = dane, aes(x=as.factor(age), y=education)) + geom_tile(aes(fill=percentagecalloutsidenetwork)) + 
  xlab("") + ylab("") + 
  scale_fill_gradient(low = "green", high = "red")

```

####Example 4 

```{r}
ggplot(data=dane1m, aes(x=age, y=totalminsusedinlastmonth)) + 
  stat_density2d(aes(fill = ..density..), geom = "raster", contour = FALSE)+ 
  scale_fill_gradient(low = "green",high = "red")

ggplot(data=dane1m, aes(x=age)) + geom_bar(aes(fill=maritalstatus))

ggplot(data=dane1m, aes(x=maritalstatus)) + geom_bar(aes(fill=as.factor(churn))) + xlab("Stan cywilny")


ggplot(data=dane1m, aes(x=education)) + geom_bar(aes(fill=as.factor(churn))) + xlab("Edykacja") + scale_fill_discrete(name="churn")  

ggplot(data=dane1m, aes(x=numberofcomplaints)) + geom_bar(aes(fill=as.factor(churn)))


```

####Example 5 (clusters)

```{r}

dane.kmns <- dane1m[,c("percentagecalloutsidenetwork","calldroprate")]

model.kmeans.3 <- kmeans(dane.kmns,3, iter.max = 3)

plot(dane.kmns, col = model.kmeans.3$cluster, pch = 19, frame = FALSE,main = "k = 3")


```